<script type="module">
	// Add to separate .vue file
    import { createApp } from 'https://unpkg.com/vue@3/dist/vue.esm-browser.js'
	//import SampleComponent from './SampleComponent.js'

    createApp({
		// components: {
		// 	// Sample Component
		// },
        data() {
            return {
                city: "",
				weather: {},
				processedWeatherData: [],
				today: new Date().toJSON().slice(0,10)
            }
        },
        methods: {
			GetWeather: getWeather,
			ProcessData: processData
        }
    }).mount('#app')

	async function getWeather(processData) {
		console.log("getWeather called")
		let promise = fetch("weather/" + this.city)
		let response = await promise
		let json = await response.json()
		this.weather = json
		// Using async await so that we can get the weather before we try to convert it to 4 day weather

		processData();

	}

	function processData() {
		let numberOfDays = 5;

		console.log("processData called")

		// let date = new Date()
		// // We want the date five days from now because that's the cutoff
		// date.setDate(date.getDate() + numberOfDays)
		// // Convert to JSON and slice because we only want yyyy-mm-dd
		// date = date.toJSON().slice(0,10);
		// console.log(date);
		
		// for (let i = 0; i < this.weather.list.length; i++) {
		// 	if (this.weather.list[i].dt_txt.slice(0,10) != date) {
		// 		this.processedWeatherData[i] = this.weather.list[i]

		// 	} else {
		// 		break;
		// 	}
		// }

		// processedWeatherData: { [
		// 	{
		// 		date: YYYY-MM-DD,
		// 		list: [
		// 		]
		// 	},
		// 	{
		// 		date: YYYY-MM-DD,
		// 		list: [
		// 		]
		// 	}
		// ]}

		let currentDate = new Date()

		for (let i = 0; i < numberOfDays; i++) {
			this.processedWeatherData[i] = {date: currentDate.toJSON().slice(0,10), list: []};
			currentDate.setDate(currentDate.getDate() + 1);
		}

		for (let i = 0; i < this.weather.list.length; i++) {
			for (let j = 0; j < this.processedWeatherData.length; j++) {
				if (this.weather.list[i].dt_txt.slice(0,10) == this.processedWeatherData[j].date) {
					this.processedWeatherData[j].list.push(this.weather.list[i])
				}
			}
		}

		console.log(this.processedWeatherData)
	}

</script>

<!DOCTYPE html>
	<head>
		<title>Weather App</title>
	</head>
	<body>
		<div id="app">
			<h1>Weather App</h1>
			<label>City Name</label>
			<input type="text" v-model="city">
			<br>
			
			<!-- Add error handling for if city isn't inputted or is invalid -->
			<button v-on:click="GetWeather(ProcessData)">Get Weather</button>
	
			<h2>Summary Table</h2>
			<template v-for="day in processedWeatherData">
				<div v-if="day.date==today">
					<h3>Today's Weather ({{day.list[0].dt_txt.slice(0,10)}})</h3>
					<ul v-for="item in day.list">
						<p>Temperature: {{item.main.temp}}</p>
						<p>Wind Speed: {{item.wind.speed}}</p>
						<p>Rainfall Level: {{item.rain}}</p>
					</ul>
				</div>
				<div v-if="day.date!=today">
					<h3>{{day.list[0].dt_txt.slice(0,10)}}</h3>
					<ul v-for="item in day.list">
						<h4>{{item.dt_txt.slice(11,20)}}</h4>
						<p>Temperature: {{item.main.temp}}</p>
						<p>Wind Speed: {{item.wind.speed}}</p>
						<p>Rainfall Level: {{item.rain}}</p>
					</ul>
				</div>

			</template>
				<!-- <template v-for="item in processedWeatherData">
					<h3>Date/Time: {{item.dt_txt}}</h3>
					<p>Temperature: {{item.main.temp}}</p>
					<p>Wind Speed: {{item.wind.speed}}</p>
					<p>Rainfall Level: {{item.rain}}</p>

				</template>-->
		</div>
	</body>
</html>